function S(){return S=Object.assign||function(t){for(var r=1;r<arguments.length;r++){var e=arguments[r];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])}return t},S.apply(this,arguments)}var k=!1;try{k=typeof localStorage<"u"}catch{}var O=typeof process<"u",q=k&&localStorage.getItem("DEBUG")||O&&process.env.DEBUG,M=q?console.log:function(t){return""};function I(t,r,e,n,c){n===void 0&&(n={});var s=S({},_(e),n),o=R(t,r,s,e,c),l=o.languageServiceHost,h=o.updateFile,g=e.createLanguageService(l),p=g.getCompilerOptionsDiagnostics();if(p.length){var y=A(t,n,e);throw new Error(e.formatDiagnostics(p,y.compilerHost))}return{name:"vfs",sys:t,languageService:g,getSourceFile:function(d){var u;return(u=g.getProgram())==null?void 0:u.getSourceFile(d)},createFile:function(d,u){h(e.createSourceFile(d,u,s.target,!1))},updateFile:function(d,u,b){var i=g.getProgram().getSourceFile(d);if(!i)throw new Error("Did not find a source file for "+d);var a=i.text,v=b??e.createTextSpan(0,a.length),m=a.slice(0,v.start)+u+a.slice(v.start+v.length),F=e.updateSourceFile(i,m,{span:v,newLength:u.length});h(F)}}}var H=function(r,e){var n=r.target||e.ScriptTarget.ES5,c=r.lib||[],s=["lib.d.ts","lib.decorators.d.ts","lib.decorators.legacy.d.ts","lib.dom.d.ts","lib.dom.iterable.d.ts","lib.webworker.d.ts","lib.webworker.importscripts.d.ts","lib.webworker.iterable.d.ts","lib.scripthost.d.ts","lib.es5.d.ts","lib.es6.d.ts","lib.es2015.collection.d.ts","lib.es2015.core.d.ts","lib.es2015.d.ts","lib.es2015.generator.d.ts","lib.es2015.iterable.d.ts","lib.es2015.promise.d.ts","lib.es2015.proxy.d.ts","lib.es2015.reflect.d.ts","lib.es2015.symbol.d.ts","lib.es2015.symbol.wellknown.d.ts","lib.es2016.array.include.d.ts","lib.es2016.d.ts","lib.es2016.full.d.ts","lib.es2017.d.ts","lib.es2017.date.d.ts","lib.es2017.full.d.ts","lib.es2017.intl.d.ts","lib.es2017.object.d.ts","lib.es2017.sharedmemory.d.ts","lib.es2017.string.d.ts","lib.es2017.typedarrays.d.ts","lib.es2018.asyncgenerator.d.ts","lib.es2018.asynciterable.d.ts","lib.es2018.d.ts","lib.es2018.full.d.ts","lib.es2018.intl.d.ts","lib.es2018.promise.d.ts","lib.es2018.regexp.d.ts","lib.es2019.array.d.ts","lib.es2019.d.ts","lib.es2019.full.d.ts","lib.es2019.intl.d.ts","lib.es2019.object.d.ts","lib.es2019.string.d.ts","lib.es2019.symbol.d.ts","lib.es2020.bigint.d.ts","lib.es2020.d.ts","lib.es2020.date.d.ts","lib.es2020.full.d.ts","lib.es2020.intl.d.ts","lib.es2020.number.d.ts","lib.es2020.promise.d.ts","lib.es2020.sharedmemory.d.ts","lib.es2020.string.d.ts","lib.es2020.symbol.wellknown.d.ts","lib.es2021.d.ts","lib.es2021.full.d.ts","lib.es2021.intl.d.ts","lib.es2021.promise.d.ts","lib.es2021.string.d.ts","lib.es2021.weakref.d.ts","lib.es2022.array.d.ts","lib.es2022.d.ts","lib.es2022.error.d.ts","lib.es2022.full.d.ts","lib.es2022.intl.d.ts","lib.es2022.object.d.ts","lib.es2022.regexp.d.ts","lib.es2022.sharedmemory.d.ts","lib.es2022.string.d.ts","lib.es2023.array.d.ts","lib.es2023.collection.d.ts","lib.es2023.d.ts","lib.es2023.full.d.ts","lib.esnext.array.d.ts","lib.esnext.asynciterable.d.ts","lib.esnext.bigint.d.ts","lib.esnext.d.ts","lib.esnext.decorators.d.ts","lib.esnext.disposable.d.ts","lib.esnext.full.d.ts","lib.esnext.intl.d.ts","lib.esnext.promise.d.ts","lib.esnext.string.d.ts","lib.esnext.symbol.d.ts","lib.esnext.weakref.d.ts"],o=e.ScriptTarget[n],l=s.filter(function(d){return d.startsWith("lib."+o.toLowerCase())}),h=s.indexOf(l.pop()),g=function(u){return u&&u.length?u.reduce(function(b,i){return i>b?i:b}):void 0},p=c.map(function(d){var u=s.filter(function(i){return i.startsWith("lib."+d.toLowerCase())});if(u.length===0)return 0;var b=s.indexOf(u.pop());return b}),y=g(p)||0,f=Math.max(h,y);return s.slice(0,f+1)};var N=function(r,e,n,c,s,o,l){var h=o||fetch,g=new Map,p=H(r,c),y="https://typescript.azureedge.net/cdn/"+e+"/typescript/lib/";function f(a){return s?s.compressToUTF16(a):a}function d(a){return s?s.decompressFromUTF16(a):a}function u(){return Promise.all(p.map(function(a){return h(y+a).then(function(v){return v.text()})})).then(function(a){a.forEach(function(v,m){return g.set("/"+p[m],v)})}).catch(function(){})}function b(){var a=l||localStorage,v=Object.keys(a);return v.forEach(function(m){m.startsWith("ts-lib-")&&!m.startsWith("ts-lib-"+e)&&a.removeItem(m)}),Promise.all(p.map(function(m){var F="ts-lib-"+e+"-"+m,x=a.getItem(F);return x?Promise.resolve(d(x)):h(y+m).then(function(w){return w.text()}).then(function(w){return a.setItem(F,f(w)),w}).catch(function(){})})).then(function(m){m.forEach(function(F,x){if(F){var w="/"+p[x];g.set(w,F)}})})}var i=n?b:u;return i().then(function(){return g})};function C(t){throw new Error("Method '"+t+"' is not implemented.")}function D(t,r){return function(){for(var e=arguments.length,n=new Array(e),c=0;c<e;c++)n[c]=arguments[c];var s=r.apply(void 0,n),o=typeof s=="string"?s.slice(0,80)+"...":s;return M.apply(void 0,["> "+t].concat(n)),M("< "+o),s}}var _=function(r){return S({},r.getDefaultCompilerOptions(),{jsx:r.JsxEmit.React,strict:!0,esModuleInterop:!0,module:r.ModuleKind.ESNext,suppressOutputPathCheck:!0,skipLibCheck:!0,skipDefaultLibCheck:!0,moduleResolution:r.ModuleResolutionKind.NodeJs})},E=function(r){return r.replace("/","/lib.").toLowerCase()};function j(t){return{args:[],createDirectory:function(){return C("createDirectory")},directoryExists:D("directoryExists",function(r){return Array.from(t.keys()).some(function(e){return e.startsWith(r)})}),exit:function(){return C("exit")},fileExists:D("fileExists",function(r){return t.has(r)||t.has(E(r))}),getCurrentDirectory:function(){return"/"},getDirectories:function(){return[]},getExecutingFilePath:function(){return C("getExecutingFilePath")},readDirectory:D("readDirectory",function(r){return r==="/"?Array.from(t.keys()):[]}),readFile:D("readFile",function(r){return t.get(r)||t.get(E(r))}),resolvePath:function(e){return e},newLine:`
`,useCaseSensitiveFileNames:!0,write:function(){return C("write")},writeFile:function(e,n){t.set(e,n)}}}function A(t,r,e){var n=new Map,c=function(l){return n.set(l.fileName,l),l},s={compilerHost:S({},t,{getCanonicalFileName:function(l){return l},getDefaultLibFileName:function(){return"/"+e.getDefaultLibFileName(r)},getDirectories:function(){return[]},getNewLine:function(){return t.newLine},getSourceFile:function(l){return n.get(l)||c(e.createSourceFile(l,t.readFile(l),r.target||_(e).target,!1))},useCaseSensitiveFileNames:function(){return t.useCaseSensitiveFileNames}}),updateFile:function(l){var h=n.has(l.fileName);return t.writeFile(l.fileName,l.text),n.set(l.fileName,l),h}};return s}function R(t,r,e,n,c){var s=[].concat(r),o=A(t,e,n),l=o.compilerHost,h=o.updateFile,g=new Map,p=0,y=S({},l,{getProjectVersion:function(){return p.toString()},getCompilationSettings:function(){return e},getCustomTransformers:function(){return c},getScriptFileNames:function(){return s.slice()},getScriptSnapshot:function(u){var b=t.readFile(u);if(b)return n.ScriptSnapshot.fromString(b)},getScriptVersion:function(u){return g.get(u)||"0"},writeFile:t.writeFile}),f={languageServiceHost:y,updateFile:function(u){p++,g.set(u.fileName,p.toString()),s.includes(u.fileName)||s.push(u.fileName),h(u)}};return f}var B=new Set(["assert","assert/strict","async_hooks","buffer","child_process","cluster","console","constants","crypto","dgram","diagnostics_channel","dns","dns/promises","domain","events","fs","fs/promises","http","http2","https","inspector","module","net","os","path","path/posix","path/win32","perf_hooks","process","punycode","querystring","readline","repl","stream","stream/promises","stream/consumers","stream/web","string_decoder","sys","timers","timers/promises","tls","trace_events","tty","url","util","util/types","v8","vm","wasi","worker_threads","zlib"]);function W(t,r){let e=new Set,n=new Map;return s=>c(s,0);async function c(s,o){let l=t.preProcessFile(s),h=t.libMap||new Map,g=l.referencedFiles.concat(l.importedFiles).concat(l.libReferenceDirectives).filter(i=>!i.fileName.endsWith(".d.ts")).filter(i=>!h.has(i.fileName)).map(i=>{let a=i.fileName;if(B.has(a.replace("node:","")))a="node";else{let[v="",m=""]=a.split("/");a=v[0]==="@"?`${v}/${m}`:v}return{module:a,version:"latest"}}).filter(i=>!i.module.startsWith(".")).filter(i=>!e.has(i.module));g.forEach(i=>e.add(i.module));let p=(await Promise.all(g.map(i=>$(i.module,i.version)))).filter(i=>!("error"in i)),y=p.filter(i=>i.files.find(a=>a.name.endsWith(".d.ts"))),f=y.map(i=>L(i,`/node_modules/${i.moduleName}`)),d=(await Promise.all(p.filter(i=>!y.includes(i)).map(i=>$(`@types/${P(i.moduleName)}`,"latest")))).filter(i=>!("error"in i)),u=d.map(i=>L(i,`/node_modules/@types/${P(i.moduleName).replace("types__","")}`)),b=f.concat(u).reduce((i,a)=>i.concat(a),[]);for(let i of p){let a=`/node_modules/${i.moduleName}`;d.includes(i)&&(a=`/node_modules/@types/${P(i.moduleName).replace("types__","")}`);let v=a+"/package.json",m=await V(i.moduleName,i.version,"/package.json");typeof m=="string"&&(n.set(v,m),r.receivedFile(m,v))}await Promise.all(b.map(async i=>{let a=await V(i.moduleName,i.moduleVersion,i.path);a&&(n.set(i.vfsPath,a),r.receivedFile(a,i.vfsPath),await c(a,o+1))}))}}async function $(t,r){let e=r||"latest";if(e.split(".").length<2){let c=await z(t,e);if(c instanceof Error)return{error:c,userFacingMessage:`Could not go from a tag to version on npm for ${t} - possible typo?`};let s=c.version;if(!s){let o=await Q(t);if(o instanceof Error)return{error:c,userFacingMessage:`Could not get versions on npm for ${t} - possible typo?`};let l=Object.entries(o.tags).join(", ");return{error:new Error("Could not find tag for module"),userFacingMessage:`Could not find a tag for ${t} called ${r}. Did find ${l}`}}e=s}let n=await U(t,e);return n instanceof Error?{error:n,userFacingMessage:`Could not get the files for ${t}@${e}. Is it possibly a typo?`}:n}function L(t,r){let e=[];for(let n of t.files)n.name.endsWith(".d.ts")&&e.push({moduleName:t.moduleName,moduleVersion:t.version,vfsPath:`${r}${n.name}`,path:n.name});return e}async function Q(t){return await fetch(`https://data.jsdelivr.com/v1/package/npm/${t}`,{cache:"no-store"}).then(r=>r.ok?r.json():new Error("OK"))}async function z(t,r){return await fetch(`https://data.jsdelivr.com/v1/package/resolve/npm/${t}@${r}`).then(e=>e.ok?e.json():new Error("OK"))}async function U(t,r){return await fetch(`https://data.jsdelivr.com/v1/package/npm/${t}@${r}/flat`).then(e=>e.ok?e.json():new Error("OK")).then(e=>({...e,moduleName:t,version:r}))}async function V(t,r,e){return await fetch(`https://cdn.jsdelivr.net/npm/${t}@${r}${e}`).then(n=>n.ok?n.text():"")}function P(t){return t.indexOf("@")===0&&t.indexOf("/")!==-1&&(t=t.slice(1).replace("/","__")),t}var G=async t=>{let r={target:ts.ScriptTarget.ESNext,module:ts.ModuleKind.ESNext,lib:["esnext","dom"],esModuleInterop:!0,moduleResolution:ts.ModuleResolutionKind.Bundler},e="/index.ts",n=await N(r,ts.version,!1,ts);n.set(e,"let a = 1");let c=j(n),s=I(c,[e],ts,r);console.log("typescript @",t);let o=W(ts,{receivedFile(f,d){s.createFile(d,f)}}),l=0;function h(f){s.updateFile(e,f||" "),clearTimeout(l),l=setTimeout(()=>o(f),500)}function g(f){return s.languageService.getCompletionsAtPosition(e,f,void 0)}function p(f){return s.languageService.getQuickInfoAtPosition(e,f)}function y(){let f=s.languageService.getSyntacticDiagnostics(e),d=s.languageService.getSemanticDiagnostics(e),u=s.languageService.getSuggestionDiagnostics(e);return[...f,...d,...u]}return{updateFile:h,getCompletionsAtPosition:g,getQuickInfoAtPosition:p,getDiagnostics:y}},J=function(t){let r=c=>c.startsWith("z")?-99:parseInt(c),e=postMessage,n=t.data;if("docChanged"in n&&(this.updateFile(n.docChanged),e({docChanged:!0})),"autocomplete"in n){let s=this.getCompletionsAtPosition(n.autocomplete)?.entries.map((o,l)=>({type:o.kind.replace("var","variable"),label:o.name,boost:r(o.sortText)}));e({autocomplete:s})}if("lint"in n){let s=this.getDiagnostics().filter(o=>o.start!=null).map((o,l)=>({from:o.start,to:o.length!=null?o.start+o.length:o.start+1,message:o.messageText+"",source:o.source,severity:["warning","error","info","info"][o.category]}));e({lint:s})}if("hover"in n){let c=this.getQuickInfoAtPosition(n.hover),s=ts.displayPartsToString(c.displayParts)+(c.documentation?.length?`
`+ts.displayPartsToString(c.documentation):"");e({hover:s})}};onmessage=async t=>{try{let r=await G(t.data);onmessage=J.bind(r),postMessage({status:"success"})}catch(r){console.error(r),postMessage({status:"failure",error:r+""})}};
